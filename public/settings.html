<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rift Proxy</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="./global/css/global.css">
</head>
<body class="settings-page">
    <div class="container">
        <header>
            <h1>Rift</h1>
        </header>

        <div class="settings-section">
            <h2>tab cloak</h2>
            <p class="settings-hint">disguise this tab to look like another site. changes apply across all rift pages.</p>
            <div class="settings-group">
                <label>PAGE TITLE</label>
                <input type="text" id="cloak-title" placeholder="Google" />
                <label>FAVICON URL</label>
                <input type="text" id="cloak-favicon" placeholder="https://google.com/favicon.ico" />
                <button class="settings-save-btn" id="cloak-save">save</button>
                <button class="settings-save-btn" id="cloak-reset" style="background: rgba(255, 80, 80, 0.15); border-color: rgba(255, 80, 80, 0.3); color: rgba(255, 80, 80, 0.9);">reset</button>
            </div>

            <h2>launch mode</h2>
            <p class="settings-hint">choose how games open when you click them.</p>
            <div class="settings-group">
                <div class="settings-option">
                    <div class="settings-option-header">
                        <span class="material-icons">web_asset</span>
                        <strong>window</strong>
                    </div>
                    <p class="settings-option-desc">opens the game in a draggable, resizable viewer on the same page. you can minimize, maximize, or close it without leaving rift.</p>
                </div>
                <div class="settings-option">
                    <div class="settings-option-header">
                        <span class="material-icons">open_in_new</span>
                        <strong>tab</strong>
                    </div>
                    <p class="settings-option-desc">opens the game in a new browser tab disguised with your cloak title & favicon. looks like a normal page to anyone watching.</p>
                </div>
                <div class="switcher" id="mode-switcher">
                    <button id="launch-window">window</button>
                    <button id="launch-tab">tab</button>
                </div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-button" onclick="location.href='/'">
            <span class="material-icons">home</span>
        </button>
        <button class="nav-button" onclick="location.href='/games'">
            <span class="material-icons">sports_esports</span>
        </button>
        <button class="nav-button" onclick="location.href='/apps'">
            <span class="material-icons">apps</span>
        </button>
        <button class="nav-button" onclick="location.href='/browser'">
            <span class="material-icons">language</span>
        </button>
        <button class="nav-button active" onclick="location.href='/settings'">
            <span class="material-icons">settings</span>
        </button>
    </nav>

    <script src="./global/js/global.js"></script>
    <script src="/components/cloaker.js"></script>
    <script src="/components/overlay.js"></script>
    <script src="/components/games.js"></script>
    <script src="/components/components.js"></script>
    <script src="/components/404.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const titleInput = document.getElementById('cloak-title');
            const faviconInput = document.getElementById('cloak-favicon');
            const saveBtn = document.getElementById('cloak-save');
            const resetBtn = document.getElementById('cloak-reset');

            // Populate from RiftShield
            const current = RiftShield.read();
            titleInput.value = current.title;
            faviconInput.value = current.favicon;

            saveBtn.addEventListener('click', () => {
                RiftShield.save(titleInput.value.trim(), faviconInput.value.trim());
                RiftOverlay.toast('cloak saved');
            });

            resetBtn.addEventListener('click', () => {
                RiftOverlay.confirm('clear all cloak settings?', () => {
                    RiftShield.clear();
                    titleInput.value = '';
                    faviconInput.value = '';
                    RiftOverlay.toast('cloak cleared');
                });
            });

            // Launch mode switcher
            const LAUNCH_KEY = 'rift__launch-mode';
            let mode = localStorage.getItem(LAUNCH_KEY) || 'window';

            const sync = () => {
                document.querySelectorAll('#mode-switcher button').forEach(btn => {
                    btn.classList.toggle('active', btn.id === 'launch-' + mode);
                });
            };
            sync();

            document.querySelectorAll('#mode-switcher button').forEach(btn => {
                btn.addEventListener('click', () => {
                    mode = btn.id.replace('launch-', '');
                    localStorage.setItem(LAUNCH_KEY, mode);
                    sync();
                    RiftOverlay.toast('launch mode: ' + mode);
                });
            });
        });
    </script>
</body>
</html>
